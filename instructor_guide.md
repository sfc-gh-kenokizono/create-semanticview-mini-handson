# 講師ガイド: セマンティックビュー作成ハンズオン

## ハンズオン概要

| 項目 | 内容 |
|------|------|
| **タイトル** | セマンティックビュー作成：手動 vs AI支援 比較体験 |
| **目的** | 手動作成の大変さとAI支援の便利さを体験し、使い分けを理解する |
| **対象者** | Snowflake初級〜中級者、データアナリスト、データエンジニア |
| **所要時間** | 約60分 |
| **前提条件** | Snowflakeトライアルアカウント、ACCOUNTADMIN権限 |

---

## ゴール：作成するセマンティックビュー

このハンズオンで作成するセマンティックビューの構成：

| 要素 | 数 | 具体的な内容 |
|------|-----|-------------|
| テーブル | 4 | PRODUCTS, SALES, MARKETING_CAMPAIGN_METRICS, SOCIAL_MEDIA |
| リレーションシップ | 2 | SALES→PRODUCTS（商品結合）、SOCIAL_MEDIA→MARKETING（カテゴリ結合） |
| ファクト | 5 | 売上金額、販売数量、インプレッション、クリック、メンション |
| ディメンション | 13 | 地域、カテゴリ、日付、プラットフォーム、インフルエンサーなど |
| メトリクス | 7 | 総売上、平均売上、総販売数、CTR、総メンション数など |

**完成後にできること**：
- 「製品カテゴリ別の売上を教えて」
- 「6月の地域別売上ランキング」
- 「キャンペーン別のクリック率は？」

👉 詳細は [reference/goal_semantic_view.md](reference/goal_semantic_view.md)

---

## タイムスケジュール（60分）

| 時間 | フェーズ | 内容 | 講師の役割 |
|------|----------|------|-----------|
| 0:00-0:15 | **導入・セットアップ** | 概要説明 + Step 0実行 | 説明 + サポート |
| 0:15-0:45 | **Step 1: 手動作成** | GUIで一つずつ設定 | 見守り + ヒント |
| 0:45-0:55 | **Step 2: AI支援作成** | SQLから自動生成 | デモ or ハンズオン |
| 0:55-1:00 | **振り返り・Q&A** | 比較まとめ | ファシリテーション |

---

## フェーズ1: 導入・セットアップ（0:00-0:15）

### 1-1. オープニング（2分）

**話すこと**：

> 「今日は、セマンティックビューを2つの方法で作成します。
> 最初は手動でGUIを使って作成し、次にAI支援を使って作成します。
> 両方を体験することで、それぞれのメリットと使い分けを理解しましょう。」

### 1-2. セマンティックビューの説明（5分）

**説明ポイント**：

1. **セマンティックビューとは**
   - テーブル間の関係性やビジネス用語を定義した「意味のレイヤー」
   - Cortex Analystが自然言語をSQLに変換する際の「辞書」

2. **構成要素**（ホワイトボードや画面で図示）

   | 要素 | 役割 | 例 |
   |------|------|-----|
   | Tables | 使用するテーブル | PRODUCTS, SALES |
   | Relationships | テーブル間の結合条件 | SALES.PRODUCT_ID → PRODUCTS.PRODUCT_ID |
   | Facts | 集計対象の数値 | SALES_AMOUNT, UNITS_SOLD |
   | Dimensions | 分析軸（「〜別」） | REGION, CATEGORY, DATE |
   | Metrics | 計算式 | SUM(SALES_AMOUNT), AVG(...) |

3. **今日のデータモデル**

   | テーブル | 内容 | 主キー |
   |---------|------|--------|
   | PRODUCTS | 商品マスタ | PRODUCT_ID |
   | SALES | 売上データ | なし |
   | MARKETING_CAMPAIGN_METRICS | マーケティング指標 | CATEGORY |
   | SOCIAL_MEDIA | SNSデータ | なし |

### 1-3. 環境セットアップ（8分）

**参加者に実行してもらう**：

1. Snowsightにログイン
2. 新しいワークシートを開く
3. `step0_setup.sql` の内容をコピー＆ペースト
4. 全文を選択して実行

**講師アクション**：

- 画面共有で手順を示す
- 「セットアップ完了」メッセージが出るまで待つ
- 「テーブル4つ作成できましたか？」と確認

**チェックポイント**：

```sql
-- 参加者に実行してもらって確認
SELECT 'PRODUCTS' AS table_name, COUNT(*) FROM products
UNION ALL SELECT 'SALES', COUNT(*) FROM sales
UNION ALL SELECT 'MARKETING_CAMPAIGN_METRICS', COUNT(*) FROM marketing_campaign_metrics
UNION ALL SELECT 'SOCIAL_MEDIA', COUNT(*) FROM social_media;
```

**よくあるトラブル**：

| 症状 | 原因 | 対処 |
|------|------|------|
| 権限エラー | ACCOUNTADMINでない | `USE ROLE ACCOUNTADMIN;` を実行 |
| テーブルが見えない | DB/スキーマが違う | `USE DATABASE SV_HANDSON_DB; USE SCHEMA RETAIL;` |

---

## フェーズ2: Step 1 手動作成（0:15-0:45）

### 2-1. 導入（1分）

**話すこと**：

> 「ではStep 1です。SnowsightのGUIを使って、手動でセマンティックビューを作成します。
> 資料（step1_manual_creation.md）を見ながら進めてください。
> 分からないところは手を挙げてください。ただし、ヒントは最小限にしますね。
> 30分後にStep 2に進みます。完成しなくても大丈夫です。」

### 2-2. 参加者作業（25分）

**講師の立ち位置**：

- **見守りモード**：参加者に考えさせる
- **ヒントは最小限**：苦労を体験してもらうのが目的
- **巡回**：詰まっている人をサポート

**進行の目安**：

| 経過時間 | 参加者の作業 | 講師アクション |
|----------|-------------|---------------|
| 0-5分 | テーブル選択・主キー設定 | 見守り |
| 5-15分 | リレーションシップ設定 | 「どのカラムで結合しますか？」と問いかけ |
| 15-20分 | ファクト・ディメンション設定 | 「売上金額はファクト？ディメンション？」 |
| 20-25分 | メトリクス設定 | 「計算式はSUM(SALES_AMOUNT)のように書きます」 |

**よくある質問と回答**：

| 質問 | 回答 |
|------|------|
| 「主キーがわからない」 | 「PRODUCTSならPRODUCT_IDが一意ですね。SALESには明確な主キーがないのでなしでOKです」 |
| 「カーディナリティって？」 | 「1つの商品に複数の売上レコードがある→Many-to-One です」 |
| 「ファクトとディメンションの違いは？」 | 「ファクトは集計する数値（SUM/AVGで使う）、ディメンションは分析軸（GROUP BYで使う）です」 |
| 「メトリクスの書き方は？」 | 「SUM(SALES_AMOUNT)のように、集計関数（ファクト名）で書きます」 |

**演出ポイント**：

- 「あと10分です」「あと5分です」と時間プレッシャーを与える
- 完成していない人がいても「大丈夫です、AI支援との比較が目的なので」と安心させる

### 2-3. 中間まとめ（4分）

**話すこと**：

> 「お疲れ様でした。手動作成、いかがでしたか？
> 完成した方、手を挙げてください。...（おそらく少数）
> そうですよね。主キーの判断、リレーションシップのカーディナリティ、
> ファクトとディメンションの分類...考えることが多かったと思います。」

**確認ポイント**：

- 「リレーションシップの設定で迷った方？」→ 多数の手が挙がるはず
- 「メトリクスの計算式の書き方に悩んだ方？」→ 多数の手が挙がるはず

> 「では、同じセマンティックビューをAI支援で作るとどうなるか、見てみましょう！」

---

## フェーズ3: Step 2 AI支援作成（0:45-0:55）

### 3-1. 進め方の選択

**パターンA: 講師デモ（推奨・10分）**
- 講師が画面共有でAI支援を実演
- 参加者は見て驚きを体験
- 時間が確実に収まる

**パターンB: 参加者ハンズオン（15分必要）**
- 参加者が自分でAI支援を体験
- より深い理解が得られる
- 時間に余裕がある場合のみ

### 3-2. デモの流れ（パターンA）

**ステップバイステップ**：

1. **セマンティックビュー作成画面を開く**
   - 「AI と ML」→「Cortex 分析」→「+ 新規作成」
   - 「新しいセマンティックビューを作成」

2. **基本情報入力**
   ```
   名前: Retail_Analytics_Autopilot_SV
   データベース: SV_HANDSON_DB
   スキーマ: RETAIL
   ```

3. **説明文入力**
   ```
   小売業の売上・マーケティングデータを分析するためのセマンティックビュー。
   製品カテゴリ別の売上分析、キャンペーン効果測定、SNSエンゲージメント分析が可能。
   ```

4. **テーブル選択**（同じ4テーブル）
   - PRODUCTS
   - SALES
   - MARKETING_CAMPAIGN_METRICS
   - SOCIAL_MEDIA

5. **AI生成オプション有効化** ← ✨ここがポイント！

   > 「ここ重要です！このオプションを有効にします」
   
   - ☑️ **Add AI-generated descriptions for tables and columns**
   - ☑️ **Include sample values**
   
   > 「事前にカタログでメタデータを準備する必要はありません！
   > セマンティックビュー作成時にAIが自動で説明文を生成してくれます」

6. **サンプルSQL入力**
   
   > 「ここにSQLクエリを入力します。このSQLからAIがリレーションシップを検出します」
   
   ```sql
   -- クエリ1: 製品カテゴリ別売上
   SELECT p.category, SUM(s.sales_amount) AS total_sales
   FROM sales s
   JOIN products p ON s.product_id = p.product_id
   GROUP BY p.category;
   
   -- クエリ2: SNSとマーケティングの結合
   SELECT sm.category, sm.platform, SUM(sm.mentions), SUM(m.clicks)
   FROM social_media sm
   JOIN marketing_campaign_metrics m ON sm.category = m.category
   GROUP BY sm.category, sm.platform;
   ```

7. **「生成」ボタンをクリック**
   
   > 「では、生成ボタンをクリックします...」
   > （1-2分待つ）
   > 「はい、完成です！」

8. **結果確認**
   
   > 「見てください。リレーションシップが自動で検出されています。
   > ファクト、ディメンションも自動分類されています。
   > メトリクスも生成されていますね。
   > そして、テーブルやカラムの説明文も自動で入っています！」

### 3-3. 強調ポイント

**比較表を画面共有で見せながら説明**：

| Step 1で苦労した点 | AI支援での解決 |
|-------------------|---------------|
| 主キーの判断 | → 自動検出 |
| リレーションシップのカーディナリティ | → SQLのJOINから自動判定 |
| ファクト/ディメンション分類 | → データ型と値から自動分類 |
| メトリクス計算式 | → SQLの集計関数から自動生成 |
| テーブル/カラムの説明文 | → AI自動生成（事前準備不要！） |

**劇的効果を出すセリフ**：

> 「Step 1で30分かかった作業が...」
> （「生成」クリック）
> 「...はい、2分で完成です！」
>
> 「しかも、リレーションシップのカーディナリティも、
> ファクトとディメンションの分類も、
> 全部AIが自動で判断してくれました。」

---

## フェーズ4: 振り返り・Q&A（0:55-1:00）

### 4-1. 比較まとめ（2分）

**スライドまたは画面共有で表示**：

| 観点 | 手動作成 | AI支援 |
|------|---------|--------|
| **所要時間** | 25-30分 | 10-15分 |
| **判断・入力** | すべて手動 | 確認・微調整のみ |
| **学び** | 構成要素を深く理解 | 結果重視で効率的 |
| **エラーリスク** | 設定ミスの可能性あり | 自動検出で精度高い |

### 4-2. 使い分けガイド（1分）

| シーン | 推奨 |
|--------|------|
| セマンティックビューを初めて学ぶ | 手動 |
| 1-2テーブルのシンプルな構造 | 手動 |
| 実務で素早く作りたい | AI支援 |
| 複数テーブルの複雑な結合 | AI支援 |
| 既存SQLクエリがある | AI支援 |

### 4-3. 締めの言葉（1分）

> 「今日のハンズオンで、手動作成の大変さとAI支援の便利さを体験いただきました。
>
> 手動作成は"セマンティックビューの構成要素を理解する"のに最適です。
> 今日苦労したからこそ、各要素の意味が分かったと思います。
>
> AI支援は"実務で素早く作る"のに最適です。
> SQLクエリを入力するだけで、AIが最適な構造を提案してくれます。
>
> 両方を知っているからこそ、適切に使い分けられます。
> ぜひ実務でも活用してください。」

### 4-4. Q&A（残り時間）

**想定される質問**：

| 質問 | 回答 |
|------|------|
| クエリ履歴は参照される？ | はい。ただしトライアルでは履歴がないため、サンプルSQLで代用しました |
| シノニム（同義語）は自動生成される？ | 一部自動提案されますが、日本語は手動追加がおすすめです |
| 作成後に編集できる？ | はい、GUIから編集可能です |
| Cortex Analystとの関係は？ | セマンティックビューはCortex Analystの「入力」になります |
| 本番環境でも使える？ | はい、パブリックプレビュー機能として利用可能です |

---

## 事前準備チェックリスト

### 講師側（ハンズオン前日まで）

- [ ] デモ用アカウントでStep 0〜2を事前実行して動作確認
- [ ] AI支援の生成時間を確認（1-2分程度か）
- [ ] 画面共有の準備（Snowsightを開いておく）
- [ ] sample_queries.sqlをコピペしやすい状態に準備
- [ ] タイマーアプリ準備（30分、10分、5分のアラート）

### 参加者側（事前アナウンス）

- [ ] Snowflakeトライアルアカウント作成
- [ ] ACCOUNTADMINロールでログイン可能か確認
- [ ] ハンズオン資材のURLを共有（GitHubリポジトリ）

### 当日開始前

- [ ] 参加者全員のログイン確認
- [ ] 画面共有テスト
- [ ] タイマー準備

---

## トラブルシューティング

| 症状 | 原因 | 対処 |
|------|------|------|
| Step 0でエラー | 権限不足 | `USE ROLE ACCOUNTADMIN;` を実行してから再試行 |
| テーブルが見えない | DB/スキーマ選択ミス | `USE DATABASE SV_HANDSON_DB; USE SCHEMA RETAIL;` |
| AI支援が表示されない | リージョン制限 | Cortexクロスリージョン設定を確認 |
| AI生成が遅い | 負荷 | 数分待つ、またはリトライ |
| 参加者が迷子 | 進行が速い | 画面共有で現在地を示す |
| 時間が足りない | 説明が長い | Step 2をデモのみに切り替え |

---

## 補足資料

### セマンティックビューの構成要素（説明用）

| 要素 | 説明 | 設定内容 |
|------|------|----------|
| **Tables** | 使用するテーブル | 主キー、シノニム、コメント |
| **Relationships** | テーブル間の結合条件 | 結合カラム、カーディナリティ |
| **Facts** | 集計対象の数値カラム | SUM/AVG/COUNTで集計される値 |
| **Dimensions** | 分析軸 | 「〜別」でGROUP BYに使うカラム |
| **Metrics** | 計算式 | SUM(SALES_AMOUNT)などの定義済み集計 |

### AI支援が内部で行うこと

| 処理 | 入力 | 出力 |
|------|------|------|
| SQLパース | JOINの条件 | リレーションシップ |
| カラム分析 | データ型と値 | ファクト/ディメンション分類 |
| 集計関数抽出 | SUM/AVGなど | メトリクス |
| カーディナリティ推定 | DISTINCT値カウント | Many-to-One判定 |
| 説明文生成 | カラム名とサンプル値 | テーブル/カラムのコメント |

---

## 参考リンク

- [セマンティックビュー概要](https://docs.snowflake.com/ja/user-guide/views-semantic/overview)
- [セマンティックビューUI操作](https://docs.snowflake.com/ja/user-guide/views-semantic/ui)
- [Cortex Analyst](https://docs.snowflake.com/ja/user-guide/snowflake-cortex/cortex-analyst/)
- [goal_semantic_view.md](reference/goal_semantic_view.md) - 完成形セマンティックビューの詳細
