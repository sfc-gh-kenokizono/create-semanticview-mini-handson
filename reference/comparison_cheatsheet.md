# セマンティックビュー作成方法 比較チートシート

## 作成方法の全体像

```
+--------------------+          +--------------------+
|    GUI Manual      |          |    AI-Assisted     |
|    (Snowsight)     |          |    (Autopilot)     |
+---------+----------+          +---------+----------+
          |                               |
          v                               v
+--------------------+          +--------------------+
| Step-by-step:      |          | Auto-generate:     |
| - Tables           |          | - Relationships    |
| - Relationships    |          | - Metrics          |
| - Facts            |          | - All automatic    |
| - Dimensions       |          |                    |
| - Metrics          |          |                    |
+--------------------+          +--------------------+
```

---

## 方法別比較表

| 比較項目 | GUI手動 | AI支援 |
|----------|---------|--------|
| **難易度** | ★★☆ | ★☆☆ |
| **所要時間** | 25-30分 | 10-15分 |
| **必要スキル** | UI操作 | SQL基礎 |
| **自動化度** | 低 | 高 |
| **柔軟性** | 高 | 中 |
| **再現性** | 低 | 中 |

---

## プロセス比較

### GUI手動作成のプロセス

| Step | 作業内容 | 難易度 |
|------|---------|--------|
| 1 | テーブル選択 | 簡単 |
| 2 | 主キー設定 | 🤔 判断が必要 |
| 3 | リレーションシップ設定（結合カラム選択） | 🤔 判断が必要 |
| 4 | リレーションシップ設定（カーディナリティ判定） | 🤔 判断が必要 |
| 5 | ファクト設定 | 🤔 分類が必要 |
| 6 | ディメンション設定 | 🤔 分類が必要 |
| 7 | メトリクス設定（計算式記述） | 🤔 SQL知識が必要 |
| 8 | 作成・検証 | - |

### AI支援作成のプロセス

| Step | 作業内容 | 難易度 |
|------|---------|--------|
| 1 | テーブル選択 | 簡単 |
| 2 | 説明文入力 | 簡単 |
| 3 | サンプルSQL入力 | コピペ |
| 4 | 「生成」クリック | ✨ 自動 |
| - | → 主キー検出 | ✅ 自動 |
| - | → リレーションシップ抽出 | ✅ 自動 |
| - | → ファクト/ディメンション分類 | ✅ 自動 |
| - | → メトリクス生成 | ✅ 自動 |
| 5 | 確認・微調整 | 確認のみ |
| 6 | 作成・検証 | - |

---

## ユースケース別推奨方法

### 🟢 AI支援が最適

| ユースケース | 理由 |
|-------------|------|
| 既存SQLクエリがある | SQLからリレーションシップを自動抽出 |
| 素早くプロトタイプを作りたい | 10-15分で完成 |
| 複数テーブルの複雑な結合 | 手動だと設定ミスしやすい |
| データモデルに詳しくない | AIが最適な構造を提案 |

### 🟡 GUI手動が最適

| ユースケース | 理由 |
|-------------|------|
| 1-2テーブルのシンプルな構造 | AI支援のオーバーヘッドが不要 |
| 学習目的 | 構成要素を理解しやすい |
| 細かいカスタマイズが必要 | 最初から意図通りに設定できる |

---

## AI支援の「材料」となるSQLクエリの書き方

### 良いSQLクエリの特徴

```sql
-- ✅ 良い例: JOIN、GROUP BY、集計関数を含む
SELECT 
    p.category,                           -- → ディメンションとして検出
    SUM(s.sales_amount) AS total_sales,   -- → メトリクスとして検出
    AVG(s.units_sold) AS avg_units        -- → メトリクスとして検出
FROM sales s
JOIN products p ON s.product_id = p.product_id  -- → リレーションシップ検出
GROUP BY p.category
ORDER BY total_sales DESC;
```

### 避けるべきSQLクエリ

```sql
-- ❌ 悪い例: 単純なSELECT *
SELECT * FROM sales;

-- ❌ 悪い例: JOINなし
SELECT SUM(sales_amount) FROM sales;
```

---

## トラブルシューティング

| 症状 | 原因 | 対策 |
|------|------|------|
| リレーションシップが検出されない | SQLにJOINがない | JOINを含むクエリを追加 |
| メトリクスが生成されない | 集計関数がない | SUM/AVG/COUNTを使ったクエリを追加 |
| ディメンションが少ない | GROUP BYがない | GROUP BY句を含むクエリを追加 |
| 意図しない構造 | SQLが不適切 | ビジネス要件に合ったSQLに修正 |

---

## ベストプラクティス

1. **まずAI支援で生成** → 素早くベースラインを作成
2. **生成結果をレビュー** → ビジネス要件と照合
3. **手動で微調整** → シノニム追加、コメント充実
4. **検証済みクエリで精度向上** → よく使う質問を登録
5. **定期的に見直し** → ビジネス変化に対応

---

## 参考リンク

- [セマンティックビュー概要](https://docs.snowflake.com/ja/user-guide/views-semantic/overview)
- [セマンティックビューUI操作](https://docs.snowflake.com/ja/user-guide/views-semantic/ui)
- [セマンティックモデル仕様](https://docs.snowflake.com/ja/user-guide/snowflake-cortex/cortex-analyst/semantic-model-spec)
